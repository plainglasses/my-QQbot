var x=Object.defineProperty;var s=(e,t)=>x(e,"name",{value:t,configurable:!0});function p(e){return e==null}s(p,"isNullable");function m(e){return e&&typeof e=="object"&&!Array.isArray(e)}s(m,"isPlainObject");function f(e,t){return Object.fromEntries(Object.entries(e).map(([n,o])=>[n,t(o,n)]))}s(f,"valueMap");function S(e){return!e||typeof e!="object"?e:Array.isArray(e)?e.map(S):e instanceof Date?new Date(e.valueOf()):e instanceof RegExp?new RegExp(e.source,e.flags):f(e,S)}s(S,"clone");var w=0,T=Symbol("schemastery"),r=s(function(e){let t=s(function(n){return r.resolve(n,t)[0]},"schema");if(e.refs){let n=f(e.refs,i=>new r(i)),o=s(i=>n[i],"getRef");for(let i in n){let c=n[i];c.sKey=o(c.sKey),c.inner=o(c.inner),c.list=c.list&&c.list.map(o),c.dict=c.dict&&f(c.dict,o)}return n[e.uid]}return Object.assign(t,e),Object.defineProperty(t,"uid",{value:w++}),Object.setPrototypeOf(t,r.prototype),t.meta||={},t},"Schema");r.prototype=Object.create(Function.prototype);r.prototype[T]=!0;var y;r.prototype.toJSON=s(function(){if(y)return y[this.uid]??=JSON.parse(JSON.stringify({...this})),this.uid;y={[this.uid]:{...this}},y[this.uid]=JSON.parse(JSON.stringify({...this}));let t={uid:this.uid,refs:y};return y=null,t},"toJSON");r.prototype.set=s(function(t,n){return this.dict[t]=n,this},"set");r.prototype.push=s(function(t){return this.list.push(t),this},"push");for(let e of["required","hidden"])Object.assign(r.prototype,{[e](t=!0){let n=r(this);return n.meta={...n.meta,[e]:t},n}});for(let e of["default","role","link","comment","description","max","min","step"])Object.assign(r.prototype,{[e](t){let n=r(this);return n.meta={...n.meta,[e]:t},n}});var b={};r.extend=s(function(t,n){b[t]=n},"extend");r.resolve=s(function(t,n,o){if(!n)return[t];if(p(t)){if(n.meta.required)throw new TypeError("missing required value");let c=n.meta.default;if(p(c))return[t];t=S(c)}let i=b[n.type];if(i)return i(t,n,o);throw new TypeError(`unsupported type "${n.type}"`)},"resolve");r.from=s(function(t){if(p(t))return r.any();if(["string","number","boolean"].includes(typeof t))return r.const(t).required();if(t[T])return t;if(typeof t=="function")switch(t){case String:return r.string().required();case Number:return r.number().required();case Boolean:return r.boolean().required();case Function:return r.function().required();default:return r.is(t).required()}else throw new TypeError(`cannot infer schema from ${t}`)},"from");r.natural=s(function(){return r.number().step(1).min(0)},"natural");r.percent=s(function(){return r.number().step(.01).min(0).max(1).role("slider")},"percent");r.extend("any",e=>[e]);r.extend("never",e=>{throw new TypeError(`expected nullable but got ${e}`)});r.extend("const",(e,{value:t})=>{if(e===t)return[t];throw new TypeError(`expected ${t} but got ${e}`)});function h(e,t,n){let{max:o=1/0,min:i=-1/0}=t;if(e>o)throw new TypeError(`expected ${n} <= ${o} but got ${e}`);if(e<i)throw new TypeError(`expected ${n} >= ${i} but got ${e}`)}s(h,"checkWithinRange");r.extend("string",(e,{meta:t})=>{if(typeof e!="string")throw new TypeError(`expected string but got ${e}`);return h(e.length,t,"string length"),[e]});r.extend("number",(e,{meta:t})=>{if(typeof e!="number")throw new TypeError(`expected number but got ${e}`);h(e,t,"number");let{step:n}=t;if(n){let o=Math.abs(e-(t.min??0))%n;if(o>=Number.EPSILON&&o<n-Number.EPSILON)throw new TypeError(`expected number multiple of ${n} but got ${e}`)}return[e]});r.extend("boolean",e=>{if(typeof e=="boolean")return[e];throw new TypeError(`expected boolean but got ${e}`)});r.extend("function",e=>{if(typeof e=="function")return[e];throw new TypeError(`expected function but got ${e}`)});r.extend("is",(e,{callback:t})=>{if(e instanceof t)return[e];throw new TypeError(`expected ${t.name} but got ${e}`)});function l(e,t,n){let[o,i]=r.resolve(e[t],n);return p(i)||(e[t]=i),o}s(l,"property");r.extend("array",(e,{inner:t,meta:n})=>{if(!Array.isArray(e))throw new TypeError(`expected array but got ${e}`);return h(e.length,n,"array length"),[e.map((o,i)=>l(e,i,t))]});r.extend("dict",(e,{inner:t,sKey:n},o)=>{if(!m(e))throw new TypeError(`expected object but got ${e}`);let i={};for(let c in e){let u;try{u=r.resolve(c,n)[0]}catch(d){if(o)continue;throw d}i[u]=l(e,c,t),e[u]=e[c],c!==u&&delete e[c]}return[i]});r.extend("tuple",(e,{list:t},n)=>{if(!Array.isArray(e))throw new TypeError(`expected array but got ${e}`);let o=t.map((i,c)=>l(e,c,i));return n?[o]:(o.push(...e.slice(t.length)),[o])});function g(e,t){for(let n in t)n in e||(e[n]=t[n])}s(g,"merge");r.extend("object",(e,{dict:t},n)=>{if(!m(e))throw new TypeError(`expected object but got ${e}`);let o={};for(let i in t){let c=l(e,i,t[i]);(!p(c)||i in e)&&(o[i]=c)}return n||g(o,e),[o]});r.extend("union",(e,{list:t,toString:n})=>{let o=[];for(let i of t)try{return r.resolve(e,i)}catch(c){o.push(c.message)}throw new TypeError(`expected ${n()} but got ${JSON.stringify(e)}`)});r.extend("intersect",(e,{list:t},n)=>{let o={};for(let i of t){let c=r.resolve(e,i,!0)[0];Object.assign(o,c)}return!n&&m(e)&&g(o,e),[o]});r.extend("transform",(e,{inner:t,callback:n})=>{let[o,i=e]=r.resolve(e,t,!0);if(m(e)){let c={};for(let u in o)u in e&&(c[u]=e[u],delete e[u]);return Object.assign(e,n(c)),[n(o)]}else return[n(o),n(i)]});function a(e,t,n){Object.assign(r,{[e](...o){let i=new r({type:e});return i.toString=n.bind(null,i),t.forEach((c,u)=>{switch(c){case"sKey":i.sKey=o[u]??r.string();break;case"inner":i.inner=r.from(o[u]);break;case"list":i.list=o[u].map(r.from);break;case"dict":i.dict=f(o[u],r.from);break;default:i[c]=o[u]}}),e==="object"||e==="dict"?i.meta.default={}:(e==="array"||e==="tuple")&&(i.meta.default=[]),i}})}s(a,"defineMethod");a("is",["callback"],({callback:e})=>e.name);a("any",[],()=>"any");a("never",[],()=>"never");a("const",["value"],({value:e})=>typeof e=="string"?JSON.stringify(e):e);a("string",[],()=>"string");a("number",[],()=>"number");a("boolean",[],()=>"boolean");a("function",[],()=>"function");a("array",["inner"],({inner:e})=>`${e.toString(!0)}[]`);a("dict",["inner","sKey"],({inner:e,sKey:t})=>`{ [key: ${t.toString()}]: ${e.toString()} }`);a("tuple",["list"],({list:e})=>`[${e.map(t=>t.toString()).join(", ")}]`);a("object",["dict"],({dict:e})=>Object.keys(e).length===0?"{}":`{ ${Object.entries(e).map(([t,n])=>`${t}${n.meta.required?"":"?"}: ${n.toString()}`).join(", ")} }`);a("union",["list"],({list:e},t)=>{let n=e.map(({toString:o})=>o()).join(" | ");return t?`(${n})`:n});a("intersect",["list"],({list:e})=>`${e.map(t=>t.toString(!0)).join(" & ")}`);a("transform",["inner","callback"],({inner:e},t)=>e.toString(t));var v=r;export{S as clone,v as default,p as isNullable,m as isPlainObject,f as valueMap};
